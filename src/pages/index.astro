---
import BaseLayout from "../layouts/BaseLayout.astro";
import Nav from "../components/Nav.astro";
import Footer from "../components/Footer.astro";
import SocialIcons from "../components/SocialIcons.astro";
import WritingList from "../components/WritingList.astro";
import GardenGraph from "../components/GardenGraph.astro";
import { getCollection } from "astro:content";

const writingPosts = await getCollection("writing", ({ data }) => !data.draft);
const sortedPosts = writingPosts
    .map((post) => ({
        slug: post.slug,
        title: post.data.title,
        date: post.data.date,
        description: post.data.description,
    }))
    .sort((a, b) => b.date.getTime() - a.date.getTime());
---

<BaseLayout title="Home">
    <div class="min-h-screen flex flex-col">
        <Nav current="home" />

        <main
            class="flex-1 pt-24 sm:pt-32 pb-16 max-w-content mx-auto px-4 sm:px-6 relative"
        >
            {/* Hero Section */}
            <section class="mb-16 sm:mb-20">
                <h1
                    class="font-charter font-bold text-3xl sm:text-hero text-ink mb-4 sm:mb-6"
                >
                    Shukraditya Bose
                </h1>

                <blockquote
                    class="border-l-2 border-secondary pl-4 sm:pl-6 py-2 mb-6 sm:mb-8"
                >
                    <p
                        class="font-display italic text-lg sm:text-xl text-secondary leading-relaxed"
                    >
                        "The future is conditionally independent of the past,
                        given the present."
                    </p>
                </blockquote>

                <SocialIcons />
            </section>

            {/* Writing Section - Single Column */}
            <section>
                <div class="flex items-baseline justify-between mb-6">
                    <span
                        class="font-sans text-label uppercase tracking-wider text-secondary"
                        >Writing</span
                    >
                    <a
                        href="/writing"
                        class="font-sans text-meta text-accent hover:underline"
                    >
                        View all
                    </a>
                </div>

                <WritingList posts={sortedPosts} showCount={5} />
            </section>
        </main>

        {/* Garden Graph - Fixed to right of viewport, centered in right space */}
        <aside
            class="hidden xl:block fixed top-[100px] w-[340px]"
            style="left: calc(75% + 30px);"
        >
            <div class="flex items-baseline justify-between mb-3">
                <span
                    class="font-sans text-label uppercase tracking-wider text-secondary"
                    >My Little Garden</span
                >
            </div>
            <GardenGraph posts={writingPosts} />
            <p class="mt-2 text-xs text-secondary font-sans text-center">
                Scroll to zoom · Drag to pan · Click to open
            </p>
        </aside>

        <Footer />
    </div>
</BaseLayout>
